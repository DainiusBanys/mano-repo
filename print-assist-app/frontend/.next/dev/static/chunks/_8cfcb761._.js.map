{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///app/components/ProtectedRoute.tsx"],"sourcesContent":["// components/ProtectedRoute.tsx\r\n\r\n'use client';\r\n\r\nimport { useAuth } from '@/context/AuthContext';\r\nimport { useRouter } from 'next/navigation';\r\nimport { ReactNode, useEffect } from 'react';\r\n\r\ninterface ProtectedRouteProps {\r\n    children: ReactNode;\r\n}\r\n\r\nexport const ProtectedRoute: React.FC<ProtectedRouteProps> = ({ children }) => {\r\n    const { isAuthenticated, token } = useAuth();\r\n    const router = useRouter();\r\n\r\n    useEffect(() => {\r\n        // This runs once on mount and whenever isAuthenticated or token changes\r\n        if (typeof window !== 'undefined' && !isAuthenticated) {\r\n            // Check localStorage as a fallback, then redirect\r\n            const storedToken = localStorage.getItem('token');\r\n            if (!storedToken) {\r\n                // User is NOT logged in. Send them to the login page.\r\n                router.replace('/login');\r\n            }\r\n        }\r\n    }, [isAuthenticated, router, token]);\r\n\r\n    // If not authenticated, we display nothing while redirecting to avoid flickering.\r\n    if (!isAuthenticated) {\r\n        return <div className=\"min-h-screen flex items-center justify-center\">Loading authentication...</div>;\r\n    }\r\n\r\n    // If authenticated, render the children (the actual dashboard content)\r\n    return <>{children}</>;\r\n};"],"names":[],"mappings":"AAAA,gCAAgC;;;;;;AAIhC;AACA;AACA;;;AAJA;;;;AAUO,MAAM,iBAAgD,CAAC,EAAE,QAAQ,EAAE;;IACtE,MAAM,EAAE,eAAe,EAAE,KAAK,EAAE,GAAG,IAAA,qIAAO;IAC1C,MAAM,SAAS,IAAA,kJAAS;IAExB,IAAA,0KAAS;oCAAC;YACN,wEAAwE;YACxE,IAAI,+CAAkB,eAAe,CAAC,iBAAiB;gBACnD,kDAAkD;gBAClD,MAAM,cAAc,aAAa,OAAO,CAAC;gBACzC,IAAI,CAAC,aAAa;oBACd,sDAAsD;oBACtD,OAAO,OAAO,CAAC;gBACnB;YACJ;QACJ;mCAAG;QAAC;QAAiB;QAAQ;KAAM;IAEnC,kFAAkF;IAClF,IAAI,CAAC,iBAAiB;QAClB,qBAAO,6LAAC;YAAI,WAAU;sBAAgD;;;;;;IAC1E;IAEA,uEAAuE;IACvE,qBAAO;kBAAG;;AACd;GAvBa;;QAC0B,qIAAO;QAC3B,kJAAS;;;KAFf"}},
    {"offset": {"line": 72, "column": 0}, "map": {"version":3,"sources":["file:///app/components/NormalizerInterface.tsx"],"sourcesContent":["// components/NormalizerInterface.tsx (UI/UX POLISHED VERSION)\r\n\r\n'use client';\r\n\r\nimport { useState } from 'react';\r\nimport { useAuth } from '@/context/AuthContext';\r\nimport axios from 'axios';\r\n\r\nconst API_BASE_URL = process.env.NEXT_PUBLIC_API_BASE_URL;\r\n\r\n// Interface definitions remain the same...\r\ninterface NormalizedResult {\r\n    raw: string;\r\n    cleaned: string;\r\n    structure: {\r\n        names: string[];\r\n        dates: string[];\r\n        message: string | null;\r\n    };\r\n    // CRITICAL NEW FLAGS FROM BACKEND:\r\n    status: string; // 'normalized_success', 'normalized_success_ai', 'normalized_suspicious', etc.\r\n    aiRequired: boolean; // True if Tier 3 (Catastrophic) was automatically called\r\n    needsReview: boolean; // True if Tier 2 (Suspicious) requires user fix\r\n}\r\n\r\nconst NormalizerInterface: React.FC = () => {\r\n    const { token, isAuthenticated, user } = useAuth();\r\n    const [rawInput, setRawInput] = useState('');\r\n    const [result, setResult] = useState<NormalizedResult | null>(null);\r\n    const [loading, setLoading] = useState(false);\r\n    const [error, setError] = useState('');\r\n\r\n    // --- NEW: Function to Call the Dedicated AI Fix Endpoint ---\r\n    const handleAIFix = async () => {\r\n        setLoading(true);\r\n        setError('');\r\n\r\n        try {\r\n            const response = await axios.post(\r\n                `${API_BASE_URL}/normalizer/ai-fix`, // <-- NEW DEDICATED ROUTE\r\n                { rawInput: result ? result.raw : rawInput }, // Use the original raw input\r\n                {\r\n                    headers: { Authorization: `Bearer ${token}` },\r\n                }\r\n            );\r\n\r\n            // The response status is now automatically 'normalized_success_ai'\r\n            setResult(response.data.result);\r\n            setRawInput(response.data.result.raw); // <--- Update all relevant states after success\r\n\r\n        } catch (err) {\r\n            if (axios.isAxiosError(err) && err.response) {\r\n                setError(err.response.data.msg || 'AI Fix failed.');\r\n            } else {\r\n                setError('A network or server error occurred during AI fix.');\r\n            }\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    // Function to call the Normalizer API (No change here)\r\n    const handleProcess = async (e: React.FormEvent) => {\r\n        e.preventDefault();\r\n        setError('');\r\n        setResult(null);\r\n\r\n        if (!rawInput.trim()) {\r\n            setError('Please enter personalization data.');\r\n            return;\r\n        }\r\n        if (!isAuthenticated || !token) {\r\n            setError('Authentication error. Please log in again.');\r\n            return;\r\n        }\r\n        setLoading(true);\r\n\r\n        try {\r\n            const response = await axios.post(\r\n                `${API_BASE_URL}/normalizer/process`,\r\n                { rawInput },\r\n                {\r\n                    headers: { Authorization: `Bearer ${token}` },\r\n                }\r\n            );\r\n            setResult(response.data.result);\r\n        } catch (err) {\r\n            if (axios.isAxiosError(err) && err.response) {\r\n                setError(err.response.data.msg || 'Processing failed.');\r\n            } else {\r\n                setError('A network or server error occurred.');\r\n            }\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    // Placeholder function for the Fulfillment API\r\n    const handleFulfill = () => {\r\n        // In a future step, this will call the /api/fulfillment/submit endpoint\r\n        alert(`Submitting clean data: \"${result?.cleaned}\" for Printify fulfillment!`);\r\n    };\r\n\r\n    return (\r\n        <div className=\"mt-8 max-w-6xl mx-auto grid grid-cols-1 lg:grid-cols-2 gap-6 p-4\">\r\n            {/* LEFT COLUMN: Input and Controls */}\r\n            <div className=\"space-y-6\">\r\n                <h2 className=\"text-2xl font-semibold text-gray-800\">1. Customer Input</h2>\r\n\r\n                {/* Subscription Warning */}\r\n                {!user?.isSubscribed && (\r\n                    <div className=\"p-3 bg-yellow-100 border-l-4 border-yellow-500 text-yellow-700\">\r\n                        <p className=\"font-bold\">Access Warning:</p>\r\n                        <p>This tool is locked until your subscription is **ACTIVE**.</p>\r\n                    </div>\r\n                )}\r\n\r\n                {/* Input Form */}\r\n                <form onSubmit={handleProcess} className=\"p-4 bg-white shadow-lg rounded-lg border border-gray-200\">\r\n                    <label htmlFor=\"rawInput\" className=\"block text-sm font-medium text-gray-700 mb-2\">\r\n                        Paste Raw Personalization Data (Max 256 chars)\r\n                    </label>\r\n                    <textarea\r\n                        id=\"rawInput\"\r\n                        rows={6} // Increased height for better view\r\n                        value={rawInput}\r\n                        onChange={(e) => setRawInput(e.target.value)}\r\n                        className=\"w-full px-3 py-2 text-gray-700 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500\"\r\n                        placeholder=\"e.g., 'Name are Shadow and Mittens. Dates must be 2021-Present'\"\r\n                        maxLength={256}\r\n                        required\r\n                    />\r\n\r\n                    <button\r\n                        type=\"submit\"\r\n                        disabled={loading || !user?.isSubscribed} // Disabled if not subscribed!\r\n                        className=\"mt-4 w-full py-3 px-4 bg-indigo-600 text-white font-semibold rounded-lg hover:bg-indigo-700 disabled:opacity-50\"\r\n                    >\r\n                        {loading ? 'Analyzing...' : 'Normalize & Validate Data'}\r\n                    </button>\r\n                </form>\r\n\r\n                {error && (\r\n                    <div className=\"p-3 bg-red-100 border-l-4 border-red-500 text-red-700\">\r\n                        <p className=\"font-bold\">Error:</p>\r\n                        <p>{error}</p>\r\n                    </div>\r\n                )}\r\n            </div>\r\n\r\n            {/* RIGHT COLUMN: Results and Proof */}\r\n            <div className=\"space-y-6\">\r\n                <h2 className=\"text-2xl font-semibold text-gray-800\">2. PrintAssist AI Output (Validated)</h2>\r\n\r\n                {result ? (\r\n                    <div className=\"p-6 bg-white shadow-lg rounded-lg border border-gray-200\">\r\n                        {/* ... Output Headers and Cleaned String Display ... */}\r\n                        {/* ---  ADD THIS DISPLAY BLOCK --- */}\r\n                        <div className=\"mb-6\">\r\n                            <h3 className=\"text-lg font-semibold text-indigo-700 mb-2\">Cleaned String (Ready for Print):</h3>\r\n                            <div className=\"p-3 bg-gray-100 border border-gray-300 rounded-md text-gray-800 font-mono text-lg\">\r\n                                {result.cleaned || 'Processing...'}\r\n                            </div>\r\n                        </div>\r\n                        {/* --- END DISPLAY BLOCK --- */}\r\n                        {/* --- NEW LOGIC: Conditional Button Display --- */}\r\n                        {result.needsReview ? (\r\n                            // TIER 2: SUSPICIOUS RESULT (Show fix button and warning)\r\n                            <div className=\"bg-red-50 border border-red-300 p-4 rounded-lg mb-4 space-y-3\">\r\n                                <p className=\"font-bold text-red-700 flex items-center\">\r\n                                    ⚠️ Review Needed: Potential Garbage Detected\r\n                                </p>\r\n                                <p className=\"text-sm text-red-600\">The automatic tool detected suspicious words. Click below to use the AI for a guaranteed clean fix.</p>\r\n\r\n                                <button\r\n                                    onClick={handleAIFix}\r\n                                    disabled={loading}\r\n                                    className=\"w-full py-2 px-4 bg-orange-500 text-white font-semibold rounded-lg hover:bg-orange-600 disabled:opacity-50\"\r\n                                >\r\n                                    {loading ? 'Consulting AI...' : 'Fix with AI for Free'}\r\n                                </button>\r\n                            </div>\r\n                        ) : (\r\n                            // TIER 1/3: CLEAN RESULT (Show fulfillment button)\r\n                            <div className=\"space-y-3\">\r\n                                <p className=\"text-sm font-medium text-green-700\">\r\n                                    {result.status.includes('ai') ? 'AI Fixed & Validated' : 'Validated by Regex'}\r\n                                </p>\r\n                                <button\r\n                                    onClick={handleFulfill}\r\n                                    className=\"w-full py-3 px-4 bg-green-600 text-white font-semibold rounded-lg hover:bg-green-700\"\r\n                                >\r\n                                    Submit to Print Provider (Final Step)\r\n                                </button>\r\n                            </div>\r\n                        )}\r\n                        {/* --- END Conditional Button Display --- */}\r\n\r\n                    </div>\r\n                ) : (\r\n                    <div className=\"p-6 bg-gray-50 shadow-lg rounded-lg border border-gray-300 text-center text-gray-500\">\r\n                        Processed output will appear here after validation.\r\n                        <div className=\"mt-4 h-32 w-full bg-gray-200 rounded-lg animate-pulse\"></div>\r\n                    </div>\r\n                )}\r\n\r\n                {/* Print Proof Mockup Area (Mimics the \"After\" image) */}\r\n                <div className=\"p-4 bg-gray-900 shadow-xl rounded-lg text-center\">\r\n                    <p className=\"text-white text-md font-medium mb-2\">Instant Print Proof Mockup</p>\r\n                    <div className=\"h-48 w-full bg-white rounded-lg flex items-center justify-center text-gray-400\">\r\n                        [Image Mockup Placeholder]\r\n                    </div>\r\n                </div>\r\n\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\n\r\nexport default NormalizerInterface;"],"names":[],"mappings":"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"}},
    {"offset": {"line": 447, "column": 0}, "map": {"version":3,"sources":["file:///app/app/dashboard/page.tsx"],"sourcesContent":["'use client';\r\n\r\nimport { useAuth } from '@/context/AuthContext';\r\nimport { ProtectedRoute } from '@/components/ProtectedRoute';\r\nimport NormalizerInterface from '@/components/NormalizerInterface'; // <--- NEW IMPORT\r\n\r\n// The core component containing the dashboard content\r\nconst DashboardContent = () => {\r\n    const { user, logout } = useAuth();\r\n\r\n    return (\r\n        <div className=\"min-h-screen bg-gray-100 p-8\">\r\n            <header className=\"flex justify-between items-center mb-6 max-w-4xl mx-auto\">\r\n                {/* Ensure the h1 and p are dark */}\r\n                <h1 className=\"text-3xl font-bold text-indigo-700\">PrintAssist AI Dashboard</h1>\r\n                <div className=\"flex items-center space-x-4\">\r\n                    {/* *** FIX: Ensure this text is dark *** */}\r\n                    <p className=\"text-gray-800\">Logged in as: <span className=\"font-semibold\">{user?.email}</span></p>\r\n                    <button\r\n                        onClick={logout}\r\n                        className=\"py-2 px-4 border border-transparent text-sm font-medium rounded-md text-white bg-red-600 hover:bg-red-700\"\r\n                    >\r\n                        Log Out\r\n                    </button>\r\n                </div>\r\n            </header>\r\n\r\n            <section className=\"mb-8 max-w-4xl mx-auto p-4 bg-white shadow-md rounded-lg\">\r\n                <h2 className=\"text-xl font-semibold mb-2 text-gray-800\">Account Status:</h2>\r\n                {/* *** FIX: Ensure this text is dark *** */}\r\n                <p className=\"text-gray-800\">Your subscription is currently:\r\n                    <span className={`font-extrabold ${user?.isSubscribed ? 'text-green-600' : 'text-yellow-600'}`}>\r\n                        {user?.isSubscribed ? ' ACTIVE' : ' TRIALING / CANCELED'}\r\n                    </span>\r\n                </p>\r\n            </section>\r\n\r\n            {/* INTEGRATE THE CORE TOOL */}\r\n            <NormalizerInterface />\r\n\r\n        </div>\r\n    );\r\n};\r\n\r\n// The page component uses the ProtectedRoute wrapper\r\nexport default function DashboardPage() {\r\n    return (\r\n        <ProtectedRoute>\r\n            <DashboardContent />\r\n        </ProtectedRoute>\r\n    );\r\n}"],"names":[],"mappings":";;;;;AAEA;AACA;AACA,+OAAoE,kBAAkB;;;AAJtF;;;;AAMA,sDAAsD;AACtD,MAAM,mBAAmB;;IACrB,MAAM,EAAE,IAAI,EAAE,MAAM,EAAE,GAAG,IAAA,qIAAO;IAEhC,qBACI,6LAAC;QAAI,WAAU;;0BACX,6LAAC;gBAAO,WAAU;;kCAEd,6LAAC;wBAAG,WAAU;kCAAqC;;;;;;kCACnD,6LAAC;wBAAI,WAAU;;0CAEX,6LAAC;gCAAE,WAAU;;oCAAgB;kDAAc,6LAAC;wCAAK,WAAU;kDAAiB,MAAM;;;;;;;;;;;;0CAClF,6LAAC;gCACG,SAAS;gCACT,WAAU;0CACb;;;;;;;;;;;;;;;;;;0BAMT,6LAAC;gBAAQ,WAAU;;kCACf,6LAAC;wBAAG,WAAU;kCAA2C;;;;;;kCAEzD,6LAAC;wBAAE,WAAU;;4BAAgB;0CACzB,6LAAC;gCAAK,WAAW,CAAC,eAAe,EAAE,MAAM,eAAe,mBAAmB,mBAAmB;0CACzF,MAAM,eAAe,YAAY;;;;;;;;;;;;;;;;;;0BAM9C,6LAAC,gJAAmB;;;;;;;;;;;AAIhC;GAnCM;;QACuB,qIAAO;;;KAD9B;AAsCS,SAAS;IACpB,qBACI,6LAAC,kJAAc;kBACX,cAAA,6LAAC;;;;;;;;;;AAGb;MANwB"}},
    {"offset": {"line": 597, "column": 0}, "map": {"version":3,"sources":["file:///app/node_modules/next/navigation.js"],"sourcesContent":["module.exports = require('./dist/client/components/navigation')\n"],"names":[],"mappings":"AAAA,OAAO,OAAO","ignoreList":[0]}}]
}