{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///app/context/AuthContext.tsx"],"sourcesContent":["// context/AuthContext.tsx\r\n'use client'; // <--- ADD THIS LINE HERE\r\n\r\nimport React, { createContext, useContext, useState, useEffect, ReactNode } from 'react';\r\nimport axios from 'axios';\r\n\r\n// Get the backend URL from the frontend environment\r\nconst API_BASE_URL = process.env.NEXT_PUBLIC_API_BASE_URL;\r\n\r\n// --- 1. Define Types ---\r\ninterface User {\r\n    id: string;\r\n    email: string;\r\n    isSubscribed: boolean;\r\n}\r\n\r\ninterface AuthContextType {\r\n    user: User | null;\r\n    token: string | null;\r\n    isAuthenticated: boolean;\r\n    login: (token: string, user: User) => void;\r\n    logout: () => void;\r\n    registerUser: (email: string, password: string) => Promise<void>;\r\n    loginUser: (email: string, password: string) => Promise<void>;\r\n}\r\n\r\n// --- 2. Create Context ---\r\nconst AuthContext = createContext<AuthContextType | undefined>(undefined);\r\n\r\n// Hook to use the context\r\nexport const useAuth = () => {\r\n    const context = useContext(AuthContext);\r\n    if (context === undefined) {\r\n        throw new Error('useAuth must be used within an AuthProvider');\r\n    }\r\n    return context;\r\n};\r\n\r\n// --- 3. Provider Component ---\r\nexport const AuthProvider: React.FC<{ children: ReactNode }> = ({ children }) => {\r\n    const [user, setUser] = useState<User | null>(null);\r\n    const [token, setToken] = useState<string | null>(null);\r\n\r\n    // Load state from localStorage on initial load\r\n    useEffect(() => {\r\n        const storedToken = localStorage.getItem('token');\r\n        const storedUser = localStorage.getItem('user');\r\n\r\n        if (storedToken && storedUser) {\r\n            setToken(storedToken);\r\n            setUser(JSON.parse(storedUser));\r\n        }\r\n    }, []);\r\n\r\n    const login = (newToken: string, newUser: User) => {\r\n        setToken(newToken);\r\n        setUser(newUser);\r\n        localStorage.setItem('token', newToken);\r\n        localStorage.setItem('user', JSON.stringify(newUser));\r\n    };\r\n\r\n    const logout = () => {\r\n        setToken(null);\r\n        setUser(null);\r\n        localStorage.removeItem('token');\r\n        localStorage.removeItem('user');\r\n    };\r\n\r\n    // --- API Interactions ---\r\n\r\n    const registerUser = async (email: string, password: string) => {\r\n        try {\r\n            const response = await axios.post(`${API_BASE_URL}/auth/register`, { email, password });\r\n\r\n            // NOTE: The registration response currently doesn't return a token, \r\n            // so the user must be redirected to log in after success.\r\n            if (response.status === 201) {\r\n                // Successful registration\r\n                console.log('Registration successful, please log in.');\r\n            }\r\n\r\n        } catch (error) {\r\n            if (axios.isAxiosError(error) && error.response) {\r\n                throw new Error(error.response.data.msg || 'Registration failed.');\r\n            }\r\n            throw new Error('An unknown error occurred during registration.');\r\n        }\r\n    };\r\n\r\n    const loginUser = async (email: string, password: string) => {\r\n        try {\r\n            const response = await axios.post(`${API_BASE_URL}/auth/login`, { email, password });\r\n\r\n            const { token: newToken, user: newUser } = response.data;\r\n\r\n            // Set global state and localStorage\r\n            login(newToken, newUser);\r\n\r\n        } catch (error) {\r\n            if (axios.isAxiosError(error) && error.response) {\r\n                throw new Error(error.response.data.msg || 'Login failed.');\r\n            }\r\n            throw new Error('An unknown error occurred during login.');\r\n        }\r\n    };\r\n\r\n\r\n    const value: AuthContextType = {\r\n        user,\r\n        token,\r\n        isAuthenticated: !!user && !!token,\r\n        login,\r\n        logout,\r\n        registerUser,\r\n        loginUser,\r\n    };\r\n\r\n    return <AuthContext.Provider value={value}>{children}</AuthContext.Provider>;\r\n};"],"names":[],"mappings":"AAAA,0BAA0B;;;;;;;AAOL;;AAJrB;AACA;;;AAHA,cAAc,0BAA0B;;;AAKxC,oDAAoD;AACpD,MAAM;AAmBN,4BAA4B;AAC5B,MAAM,4BAAc,IAAA,8KAAa,EAA8B;AAGxD,MAAM,UAAU;;IACnB,MAAM,UAAU,IAAA,2KAAU,EAAC;IAC3B,IAAI,YAAY,WAAW;QACvB,MAAM,IAAI,MAAM;IACpB;IACA,OAAO;AACX;GANa;AASN,MAAM,eAAkD,CAAC,EAAE,QAAQ,EAAE;;IACxE,MAAM,CAAC,MAAM,QAAQ,GAAG,IAAA,yKAAQ,EAAc;IAC9C,MAAM,CAAC,OAAO,SAAS,GAAG,IAAA,yKAAQ,EAAgB;IAElD,+CAA+C;IAC/C,IAAA,0KAAS;kCAAC;YACN,MAAM,cAAc,aAAa,OAAO,CAAC;YACzC,MAAM,aAAa,aAAa,OAAO,CAAC;YAExC,IAAI,eAAe,YAAY;gBAC3B,SAAS;gBACT,QAAQ,KAAK,KAAK,CAAC;YACvB;QACJ;iCAAG,EAAE;IAEL,MAAM,QAAQ,CAAC,UAAkB;QAC7B,SAAS;QACT,QAAQ;QACR,aAAa,OAAO,CAAC,SAAS;QAC9B,aAAa,OAAO,CAAC,QAAQ,KAAK,SAAS,CAAC;IAChD;IAEA,MAAM,SAAS;QACX,SAAS;QACT,QAAQ;QACR,aAAa,UAAU,CAAC;QACxB,aAAa,UAAU,CAAC;IAC5B;IAEA,2BAA2B;IAE3B,MAAM,eAAe,OAAO,OAAe;QACvC,IAAI;YACA,MAAM,WAAW,MAAM,mJAAK,CAAC,IAAI,CAAC,GAAG,aAAa,cAAc,CAAC,EAAE;gBAAE;gBAAO;YAAS;YAErF,qEAAqE;YACrE,0DAA0D;YAC1D,IAAI,SAAS,MAAM,KAAK,KAAK;gBACzB,0BAA0B;gBAC1B,QAAQ,GAAG,CAAC;YAChB;QAEJ,EAAE,OAAO,OAAO;YACZ,IAAI,mJAAK,CAAC,YAAY,CAAC,UAAU,MAAM,QAAQ,EAAE;gBAC7C,MAAM,IAAI,MAAM,MAAM,QAAQ,CAAC,IAAI,CAAC,GAAG,IAAI;YAC/C;YACA,MAAM,IAAI,MAAM;QACpB;IACJ;IAEA,MAAM,YAAY,OAAO,OAAe;QACpC,IAAI;YACA,MAAM,WAAW,MAAM,mJAAK,CAAC,IAAI,CAAC,GAAG,aAAa,WAAW,CAAC,EAAE;gBAAE;gBAAO;YAAS;YAElF,MAAM,EAAE,OAAO,QAAQ,EAAE,MAAM,OAAO,EAAE,GAAG,SAAS,IAAI;YAExD,oCAAoC;YACpC,MAAM,UAAU;QAEpB,EAAE,OAAO,OAAO;YACZ,IAAI,mJAAK,CAAC,YAAY,CAAC,UAAU,MAAM,QAAQ,EAAE;gBAC7C,MAAM,IAAI,MAAM,MAAM,QAAQ,CAAC,IAAI,CAAC,GAAG,IAAI;YAC/C;YACA,MAAM,IAAI,MAAM;QACpB;IACJ;IAGA,MAAM,QAAyB;QAC3B;QACA;QACA,iBAAiB,CAAC,CAAC,QAAQ,CAAC,CAAC;QAC7B;QACA;QACA;QACA;IACJ;IAEA,qBAAO,6LAAC,YAAY,QAAQ;QAAC,OAAO;kBAAQ;;;;;;AAChD;IA/Ea;KAAA"}}]
}